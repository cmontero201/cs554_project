<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body>

    <div id="chat">
      <div id="chat_box">
      </div>
      <input type="text" id="text_box">
      <input type="submit" name="submit" id="submit">
    </div>

    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      $(document).ready(function() {
        const url = window.location.href.split("/");
        const id = url[url.length - 1];
        let socket = io();
        socket.emit("join_chat", {id: id, user: "REPLACE THIS AT SOME POINT"});

        $("#submit").on("click", function(){
          console.log("clicked");
          let contents = document.getElementById("text_box").value;
          if (contents != "") {
            document.getElementById("text_box").value = "";
            let ack = socket.emit('send_msg', {id: id, msg: contents});
            if (ack != null && ack != undefined) {
              $("#text_box").text("");
            }
          }
        });

        socket.on('announce', function(data) {
          console.log(data);
          $('#chat_box').append('<p>'+ data.message + '</p>')
        });

        window.onunload = function leaving() {
          socket.emit('disc', {id: id, user: "REPLACE THIS AT SOME POINT"});
        }
      });
    </script>
  </body>
</html>
